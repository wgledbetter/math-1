<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Stan Math Library: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="$standoxy.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="stanlogo-main.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://mc-stan.org/math">Stan Math Library</a>
   &#160;<span id="projectnumber">4.0.1</span>
   </div>
   <div id="projectbrief">Automatic Differentiation</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Stan Math Library Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b>Stan Math Library</b> is a C++, reverse-mode automatic differentiation library designed to be usable, extensive and extensible, efficient, scalable, stable, portable, and redistributable in order to facilitate the construction and utilization of algorithms that utilize derivatives.</p>
<p> 
 <div><a href="https://zenodo.org/badge/latestdoi/38388440"><img src="https://zenodo.org/badge/38388440.svg"/></a></div>
</p>
<h2>Licensing </h2>
<p>The Stan Math Library is licensed under the <a href="https://github.com/stan-dev/math/blob/develop/LICENSE%2Emd">new BSD license</a>.</p>
<p>The Stan Math Library depends on the Intel TBB library which is licensed under the Apache 2.0 license. This dependency implies an additional restriction as compared to the new BSD license alone. The Apache 2.0 license is incompatible with GPL-2 licensed code if distributed as a unitary binary. You may refer to the Apache 2.0 evaluation page on the <a href="https://github.com/stan-dev/math/wiki/Apache-2.0-License-Evaluation">Stan Math wiki</a>.</p>
<h2>Required Libraries </h2>
<p>Stan Math depends on four libraries:</p>
<ul>
<li>Boost (version 1.75.0): <a href="https://www.boost.org">Boost Home Page</a></li>
<li><a class="el" href="d0/da5/namespace_eigen.html" title="(Expert) Numerical traits for algorithmic differentiation variables. ">Eigen</a> (version 3.3.9: <a href="https://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen Home Page</a></li>
<li>SUNDIALS (version 5.6.1): <a href="https://computation.llnl.gov/projects/sundials/sundials-software">Sundials Home Page</a></li>
<li>Intel TBB (version 2019_U8): <a href="https://www.threadingbuildingblocks.org">Intel TBB Home Page</a></li>
</ul>
<p>These are distributed under the <code>lib/</code> subdirectory. Only these versions of the dependent libraries have been tested with Stan Math.</p>
<h2>Documentation </h2>
<p>Documentation for Stan math is available at <a href="https://mc-stan.org/math/">mc-stan.org/math</a></p>
<h2>Installation </h2>
<p>The Stan Math Library is a C++ library which depends on the Intel TBB library and requires for some functionality (ordinary differential equations and root solving) the Sundials library. The build system is the make facility, which is used to manage all dependencies.</p>
<p>A simple hello world program using Stan Math is as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="d4/d78/math_8hpp.html">stan/math.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;log normal(1 | 2, 3)=&quot;</span></div><div class="line">            &lt;&lt; <a class="code" href="d5/db4/group__prob__dists.html#ga4cd21352e848871cf93fc56ab0fccc83">stan::math::normal_log</a>(1, 2, 3)</div><div class="line">            &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><p>If this is in the file <code>/path/to/foo/foo.cpp</code>, then you can compile and run this with something like this, with the <code>/path/to</code> business replaced with actual paths:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&gt; cd /path/to/foo</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&gt; make -j4 -f /path/to/stan-math/make/standalone math-libs</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&gt; make -f /path/to/stan-math/make/standalone foo</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&gt; ./foo</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;log normal(1 | 2, 3)=-2.07311</div></div><!-- fragment --><p>The first make command with the <code>math-libs</code> target ensures that all binary dependencies of Stan Math are built and ready to use. The <code>-j4</code> instructs <code>make</code> to use 4 cores concurrently which should be adapted to your needs. The second make command ensures that the Stan Math sources and all of the dependencies are available to the compiler when building <code>foo</code>.</p>
<p>An example of a real instantiation whenever the path to Stan Math is <code>~/stan-dev/math/</code>:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&gt; make -j4 -f ~/stan-dev/math/make/standalone math-libs</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&gt; make -f ~/stan-dev/math/make/standalone foo</div></div><!-- fragment --><p> The <code>math-libs</code> target has to be called only once, and can be omitted for subsequent compilations.</p>
<p>The standalone makefile ensures that all the required <code>-I</code> include statements are given to the compiler and the necessary libraries are linked: <code>~/stan-dev/math</code> and <code>~/stan-dev/math/lib/eigen_3.3.9</code> and <code>~/stan-dev/math/lib/boost_1.75.0</code> and <code>~/stan-dev/math/lib/sundials_5.6.1/include</code> and <code>~/stan-dev/math/lib/tbb_2019_U8/include</code>. The <code>~/stan-dev/math/lib/tbb</code> directory is created by the <code>math-libs</code> makefile target automatically and contains the dynamically loaded Intel TBB library. The flags <code>-Wl,-rpath,...</code> instruct the linker to hard-code the path to the dynamically loaded Intel TBB library inside the stan-math directory into the final binary. This way the Intel TBB is found when executing the program.</p>
<p>Note for Windows users: On Windows the <code>-rpath</code> feature as used by Stan Math to hardcode an absolute path to a dynamically loaded library does not work. On Windows the Intel TBB dynamic library <code>tbb.dll</code> is located in the <code>math/lib/tbb</code> directory. The user can choose to copy this file to the same directory of the executable or to add the directory <code>/path/to/math/lib/tbb</code> as absolute path to the system-wide <code>PATH</code> variable.</p>
<h2>Intel TBB </h2>
<p><code>math</code> now supports the new interface of Intel TBB and allows using external library (e.g., with <a href="https://github.com/oneapi-src/oneTBB"><code>oneTBB</code></a> or the system TBB library), using <code>TBB_LIB</code> and <code>TBB_INC</code> environment variables.</p>
<p>To build the development version of <code>math</code> with <a href="https://github.com/oneapi-src/oneTBB"><code>oneTBB</code></a>:</p>
<ul>
<li>Install <a href="https://github.com/oneapi-src/oneTBB"><code>oneTBB</code></a>.</li>
</ul>
<p>For example, installing <a href="https://github.com/oneapi-src/oneTBB"><code>oneTBB</code></a> on Linux 64-bit (<code>x86_64</code>) to <code>$HOME</code> directory (change if needed!): </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;TBB_VERSION=&quot;2021.1.1&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;wget https://github.com/oneapi-src/oneTBB/releases/download/v2021.1.1/oneapi-tbb-$TBB_VERSION-lin.tgz</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;tar zxvf oneapi-tbb-$TBB_VERSION-lin.tgz -C $HOME</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;export TBB=&quot;$HOME/oneapi-tbb-$TBB_VERSION&quot;</div></div><!-- fragment --><ul>
<li>Set the TBB environment variables (specifically: <code>TBB</code> for the installation prefix, <code>TBB_INC</code> for the directory that includes the header files, and <code>TBB_LIB</code> for the libraries directory).</li>
</ul>
<p>For example, installing <a href="https://github.com/oneapi-src/oneTBB"><code>oneTBB</code></a> on Linux 64-bit (<code>x86_64</code>) to <code>$HOME</code> directory (change if needed!): </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;source $TBB/env/vars.sh intel64</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;export TBB_INC=&quot;$TBB/include&quot;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;export TBB_LIB=&quot;$TBB/lib/intel64/gcc4.8&quot;</div></div><!-- fragment --><ul>
<li>Set <code>Stan</code> local compiler flags to use the new TBB interface: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;mkdir -p ~/.config/stan</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;echo TBB_INTERFACE_NEW=true&gt;&gt; ~/.config/stan/make.local</div></div><!-- fragment --></li>
</ul>
<h2>Compilers </h2>
<p>The above example will use the default compiler of the system as determined by <code>make</code>. On Linux this is usually <code>g++</code>, on MacOS <code>clang++</code>, and for Windows this is <code>g++</code> if the RTools for Windows are used. There's nothing special about any of these and they can be changed through the <code>CXX</code> variable of <code>make</code>. The recommended way to set this variable for the Stan Math library is by creating a <code>make/local</code> file within the Stan Math library directory. Defining <code>CXX=g++</code> in this file will ensure that the GNU C++ compiler is always used, for example. The compiler must be able to fully support C++11 and partially the C++14 standard. The <code>g++</code> 4.9.3 version part of RTools for Windows currently defines the minimal C++ feature set required by the Stan Math library.</p>
<p>Note that whenever the compiler is changed, the user usually must clean and rebuild all binary dependencies with the commands: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&gt; make -f path/to/stan-math/make/standalone math-clean</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&gt; make -j4 -f path/to/stan-math/make/standalone math-libs</div></div><!-- fragment --><p> This ensures that the binary dependencies are created with the new compiler. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->

<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
    <div class="contents" style="font-size:100%;">
      <span style="float:left; margin=0 1em 0 1em;">
      &nbsp;&nbsp;&nbsp;&nbsp;
      [ <a href="http://mc-stan.org/">Stan Home Page</a> ]
      </span>
      <span style="float:right; margin=0 1em 0 1em;">
      <i>&copy; 2011&ndash;2019,
      Stan Development Team.
      &nbsp;&nbsp;&nbsp;&nbsp;
      </i>
      </span>
    </div> </li>
  </ul>
</div>
</body>
</html>
